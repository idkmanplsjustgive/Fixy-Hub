--// Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

--// Configuration
local GUI_COLOR = Color3.fromRGB(128, 0, 128) -- Purple
local ESP_HUMANOID = {}
local DEAD_BODIES = {}
local ROLE_TAGS = {}

--// Wind GUI Setup
local Wind = loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/Wind.lua"))()
local Hub = Wind:CreateWindow({Name = "Lley And Aris Chat Gpt Hub", ThemeColor = GUI_COLOR})

--// Noclip Tab
local NoclipTab = Hub:AddTab("Noclip")
local NoclipToggle = NoclipTab:AddToggle("Enable Noclip", false, function(state)
    if state then
        local connection
        connection = RunService.Stepped:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid:ChangeState(11) -- Noclip
            end
        end)
        NoclipToggle.Connection = connection
    else
        if NoclipToggle.Connection then
            NoclipToggle.Connection:Disconnect()
        end
    end
end)

--// ESP Tab
local ESPTab = Hub:AddTab("ESP")
local ESPToggle = ESPTab:AddToggle("Humanoid ESP", false, function(state)
    for player, gui in pairs(ESP_HUMANOID) do
        if gui and gui.Parent then
            gui.Enabled = state
        end
    end
end)

-- Function to attach ESP to humanoid
local function AttachESP(player)
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChild("HumanoidRootPart")
    if not hum then return end
    
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "ESPBillboard"
    Billboard.Parent = game.CoreGui
    Billboard.Adornee = hum
    Billboard.Size = UDim2.new(0,150,0,40)
    Billboard.AlwaysOnTop = true

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Text = player.Name
    Text.TextColor3 = Color3.fromRGB(255,255,255)

    ESP_HUMANOID[player] = Billboard
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        if ESPToggle.Value then
            AttachESP(player)
        end
    end)
end)

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        if ESPToggle.Value then
            AttachESP(player)
        end
    end
end

--// Game Enhancer Tab
local GameTab = Hub:AddTab("Game Enhancer")

-- Full Vision Toggle
GameTab:AddToggle("Full Vision", false, function(state)
    Workspace.CurrentCamera:GetChildren()
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name ~= "Terrain" then
            obj.Transparency = state and 0 or 0
        end
    end
end)

-- Max Zoom Toggle
GameTab:AddToggle("Max Zoom", false, function(state)
    Workspace.CurrentCamera.CameraSubject = LocalPlayer.Character
    Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
    Workspace.CurrentCamera.CameraMaxZoomDistance = state and 400 or 16
end)

-- Dead Body ESP
local DeadBodyToggle = GameTab:AddToggle("Dead Body ESP", false, function(state)
    for _, body in pairs(DEAD_BODIES) do
        if body.TextLabel then
            body.TextLabel.Visible = state
        end
    end
end)

local function CreateDeadBodyTag(part)
    if DEAD_BODIES[part] then return end
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "DeadBodyTag"
    Billboard.Parent = game.CoreGui
    Billboard.Adornee = part
    Billboard.Size = UDim2.new(0,200,0,40)
    Billboard.AlwaysOnTop = true

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Text = "DEAD BODY!"
    DEAD_BODIES[part] = {Billboard = Billboard, TextLabel = Text}

    -- Rainbow effect
    spawn(function()
        while true do
            for i=0,1,0.01 do
                Text.TextColor3 = Color3.fromHSV(i,1,1)
                wait(0.05)
            end
        end
    end)

    -- Notification
    local notif = Wind:Notification({Title = "DEAD BODY!", Message = "A dead body appeared!", Duration = 3})
end

-- Monitor dead bodies
RunService.Heartbeat:Connect(function()
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj.Name == "DeadBody" then
            if obj:FindFirstChild("HumanoidRootPart") then
                CreateDeadBodyTag(obj.HumanoidRootPart)
            end
        end
    end
end)

-- Role Viewer
local RoleViewerToggle = GameTab:AddToggle("Role Viewer", false, function(state)
    for player, tag in pairs(ROLE_TAGS) do
        if tag and tag.Billboard then
            tag.Billboard.Enabled = state
        end
    end
end)

local ROLE_COLORS = {
    Crewmate = Color3.fromRGB(0,255,0),
    Imposter = Color3.fromRGB(255,0,0),
    Neutral = Color3.fromRGB(255,165,0)
}

local function AttachRoleTag(player)
    local char = player.Character
    if not char then return end
    local torso = char:FindFirstChild("UpperTorso") or char:FindFirstChild("Torso")
    if not torso then return end

    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "RoleTag"
    Billboard.Adornee = torso
    Billboard.Size = UDim2.new(0,150,0,50)
    Billboard.AlwaysOnTop = true
    Billboard.Parent = game.CoreGui
    Billboard.Enabled = RoleViewerToggle.Value

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Font = Enum.Font.GothamBold
    Text.TextStrokeTransparency = 0.25
    Text.Text = ""
    Text.TextColor3 = Color3.fromRGB(255,255,255)

    ROLE_TAGS[player] = {Billboard = Billboard, Text = Text}

    local function UpdateRole()
        local ps = player:FindFirstChild("PublicStates")
        if ps then
            local roleVal = ps:FindFirstChild("Role")
            if roleVal then
                Text.Text = roleVal.Value
                Text.TextColor3 = ROLE_COLORS[roleVal.Value] or Color3.new(1,1,1)
            end
        end
    end

    if player:FindFirstChild("PublicStates") then
        for _, v in pairs(player.PublicStates:GetChildren()) do
            if v:IsA("StringValue") then
                v.Changed:Connect(UpdateRole)
            end
        end
    end
    UpdateRole()
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        AttachRoleTag(player)
    end)
end)

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        AttachRoleTag(player)
    end
end
