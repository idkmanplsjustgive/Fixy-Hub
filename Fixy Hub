--[[ 
    Lley And Aris Chat Gpt Hub (All-in-one Luau LocalScript)
    ✔ Purple WindUI Hub
    ✔ Noclip
    ✔ ESP (Humanoids Only) WITH USERNAMES (small text)
    ✔ Game Enhancer (Full Vision, Max Zoom)
    ✔ Dead Body ESP (rainbow text + notification)
    ✘ Role View (REMOVED)
]]--

-- ======= Services =======
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- Attempt Drawing API
local ok, Drawing = pcall(function() return Drawing end)
if not ok then Drawing = nil end

-- ==== Load WindUI ====
local WindUI
do
    local s, result = pcall(function() return require("./src/Init") end)
    WindUI = s and result or loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()
end

-- ======= Runtime State =======
local state = {
    noclip = false,
    esp = false,
    maxZoom = false,
    fullVision = false,
    deadBodyESP = false,
}

local oldZoom = player.CameraMaxZoomDistance
local oldLight = {
    FogStart = Lighting.FogStart,
    FogEnd = Lighting.FogEnd,
    Ambient = Lighting.Ambient,
}

local ESPStorage = {}
local BodyBOX = {}
local BodyTEXT = {}
local notified = {}
local hue = 0

local function rainbow()
    hue = (hue + 1) % 360
    return Color3.fromHSV(hue/360, 1, 1)
end

-- ======= Create Drawing safely =======
local function newBox()
    if not Drawing then return nil end
    local b = Drawing.new("Square")
    b.Color = Color3.fromRGB(255,255,255)
    b.Thickness = 2
    b.Filled = false
    b.Size = Vector2.new(25,25)
    b.Visible = false
    return b
end

local function newText(size)
    if not Drawing then return nil end
    local t = Drawing.new("Text")
    t.Size = size
    t.Center = true
    t.Outline = true
    t.Color = Color3.fromRGB(255,255,255)
    t.Text = ""
    t.Visible = false
    return t
end

-- ======= Notification UI =======
local function notify(title)
    local gui = Instance.new("ScreenGui")
    gui.Parent = player:WaitForChild("PlayerGui")
    gui.ResetOnSpawn = false

    local frame = Instance.new("Frame")
    frame.Parent = gui
    frame.Size = UDim2.new(0, 260, 0, 60)
    frame.Position = UDim2.new(1, 260, 0, 100)
    frame.BackgroundColor3 = Color3.fromRGB(200,0,0)
    frame.BorderSizePixel = 0
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0,10)

    local txt = Instance.new("TextLabel", frame)
    txt.Size = UDim2.new(1, -10, 1, 0)
    txt.Position = UDim2.new(0,5,0,0)
    txt.BackgroundTransparency = 1
    txt.Font = Enum.Font.GothamBold
    txt.TextSize = 20
    txt.Text = title
    txt.TextColor3 = Color3.new(1,1,1)
    txt.TextXAlignment = Enum.TextXAlignment.Left

    TweenService:Create(frame, TweenInfo.new(0.3),{
        Position = UDim2.new(1, -270, 0, 100)
    }):Play()

    task.delay(3,function()
        TweenService:Create(frame, TweenInfo.new(0.3),{
            Position = UDim2.new(1, 260, 0, 100)
        }):Play()
        task.delay(0.3,function()
            gui:Destroy()
        end)
    end)
end

-- ======= WindUI Window =======
local Window = WindUI:CreateWindow({
    Title = "Lley And Aris Chat Gpt Hub",
    Folder = "GPT_Aris",
    OpenButton = {
        Title = "Lley And Aris Chat Gpt Hub",
        Enabled = true,
        Draggable = true,
        Color = ColorSequence.new(Color3.fromRGB(128,0,128), Color3.fromRGB(200,100,255))
    }
})

WindUI:AddTheme({
    Name = "PurpleTheme",
    Accent = Color3.fromRGB(128,0,128),
    WindowBackground = Color3.fromRGB(20,0,40),
    Text = Color3.new(1,1,1),
})
WindUI:SetTheme("PurpleTheme")

local main = Window:Tab({ Title="Main", Icon="solar:check-square-bold" })

-- ========== Noclip ============
local secN = main:Section({Title="Noclip"})
secN:Toggle({
    Title="Enable Noclip",
    Callback=function(v)
        state.noclip = v
    end
})

-- ========== ESP ============
local secE = main:Section({Title="ESP"})
secE:Toggle({
    Title="ESP (Humanoids Only)",
    Callback=function(v)
        state.esp = v
    end
})

-- ========== Game Enhancer ============
local secG = main:Section({Title="Game Enhancer"})
secG:Toggle({
    Title="Full Vision",
    Callback=function(v)
        state.fullVision = v
        if v then
            Lighting.FogStart = 0
            Lighting.FogEnd = 999999
            Lighting.Ambient = Color3.new(1,1,1)
        else
            Lighting.FogStart = oldLight.FogStart
            Lighting.FogEnd = oldLight.FogEnd
            Lighting.Ambient = oldLight.Ambient
        end
    end
})
secG:Toggle({
    Title="Max Zoom",
    Callback=function(v)
        state.maxZoom = v
        player.CameraMaxZoomDistance = v and 1000 or oldZoom
    end
})

secG:Toggle({
    Title="Dead Body ESP",
    Callback=function(v)
        state.deadBodyESP = v
    end
})

-- ======= Dead Body Detection =======
Workspace.ChildAdded:Connect(function(obj)
    if obj.Name == "DeadBody" then
        if not notified[obj] then
            notify("DEAD BODY!")
            notified[obj] = true
        end
        if state.deadBodyESP and Drawing then
            BodyBOX[obj] = newBox()
            BodyTEXT[obj] = newText(18)
            BodyTEXT[obj].Text = "DEAD BODY"
        end
    end
end)

-- ======= Noclip enforcement =======
RunService.Stepped:Connect(function()
    if state.noclip and player.Character then
        for _,p in ipairs(player.Character:GetDescendants()) do
            if p:IsA("BasePart") then p.CanCollide = false end
        end
    end
end)

-- ======= ESP + Dead Body Rendering =======
RunService.RenderStepped:Connect(function()
    -- Player ESP (USERNAME)
    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= player and pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") then
            if state.esp and Drawing then
                if not ESPStorage[pl] then
                    ESPStorage[pl] = {
                        Box = newBox(),
                        Text = newText(14)
                    }
                end

                local d = ESPStorage[pl]
                local hrp = pl.Character.HumanoidRootPart
                local pos, vis = camera:WorldToViewportPoint(hrp.Position)
                if vis then
                    d.Box.Position = Vector2.new(pos.X-12, pos.Y-12)
                    d.Box.Visible = true

                    d.Text.Position = Vector2.new(pos.X, pos.Y-25)
                    d.Text.Text = pl.Name
                    d.Text.Visible = true
                else
                    d.Box.Visible = false
                    d.Text.Visible = false
                end
            else
                if ESPStorage[pl] then
                    pcall(function() ESPStorage[pl].Box:Remove() end)
                    pcall(function() ESPStorage[pl].Text:Remove() end)
                    ESPStorage[pl] = nil
                end
            end
        end
    end

    -- Dead Body ESP
    if state.deadBodyESP and Drawing then
        for body, box in pairs(BodyBOX) do
            if body and body.Parent then
                local part = body.PrimaryPart or body:FindFirstChildWhichIsA("BasePart")
                if part then
                    local pos, vis = camera:WorldToViewportPoint(part.Position + Vector3.new(0,3,0))
                    if vis then
                        box.Position = Vector2.new(pos.X-15, pos.Y-15)
                        box.Visible = true

                        local txt = BodyTEXT[body]
                        txt.Position = Vector2.new(pos.X, pos.Y-25)
                        txt.Color = rainbow()
                        txt.Visible = true
                    end
                end
            end
        end
    end
end)

-- END SCRIPT
