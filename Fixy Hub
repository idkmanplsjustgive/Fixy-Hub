-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- Load Wind
local Wind = loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/Wind.lua"))()
local Hub = Wind:CreateWindow({Name = "Lley And Aris Chat Gpt Hub", ThemeColor = Color3.fromRGB(128,0,128)})

-- Tabs
local NoclipTab = Hub:AddTab("Noclip")
local ESPTab = Hub:AddTab("ESP")
local GameTab = Hub:AddTab("Game Enhancer")

-- Noclip
local noclipEnabled = false
local noclipConn
NoclipTab:AddToggle("Enable Noclip", false, function(state)
    noclipEnabled = state
    if state then
        noclipConn = RunService.Stepped:Connect(function()
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
                LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Physics)
            end
        end)
    else
        if noclipConn then noclipConn:Disconnect() end
    end
end)

-- ESP
local ESP_HUMANOID = {}
local ESPToggle
ESPToggle = ESPTab:AddToggle("Humanoid ESP", false, function(state)
    for _, gui in pairs(ESP_HUMANOID) do
        gui.Enabled = state
    end
end)

local function AttachESP(player)
    if not player.Character then return end
    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "ESPBillboard"
    Billboard.Adornee = hrp
    Billboard.Size = UDim2.new(0,150,0,40)
    Billboard.AlwaysOnTop = true
    Billboard.Parent = game.CoreGui

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Text = player.Name
    Text.TextColor3 = Color3.fromRGB(255,255,255)

    Billboard.Enabled = ESPToggle.Value
    ESP_HUMANOID[player] = Billboard
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        AttachESP(player)
    end)
end)

for _, p in pairs(Players:GetPlayers()) do
    if p ~= LocalPlayer then AttachESP(p) end
end

-- Game Enhancer
local ROLE_TAGS = {}
local DEAD_BODIES = {}
local ROLE_COLORS = {
    Crewmate = Color3.fromRGB(0,255,0),
    Imposter = Color3.fromRGB(255,0,0),
    Neutral = Color3.fromRGB(255,165,0)
}

local RoleViewerToggle = GameTab:AddToggle("Role Viewer", false, function(state)
    for _, tag in pairs(ROLE_TAGS) do
        tag.Billboard.Enabled = state
    end
end)

local DeadBodyToggle = GameTab:AddToggle("Dead Body ESP", false, function(state)
    for _, body in pairs(DEAD_BODIES) do
        body.Billboard.Enabled = state
    end
end)

local function AttachRoleTag(player)
    if not player.Character then return end
    local torso = player.Character:FindFirstChild("UpperTorso") or player.Character:FindFirstChild("Torso")
    if not torso then return end

    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "RoleTag"
    Billboard.Adornee = torso
    Billboard.Size = UDim2.new(0,150,0,50)
    Billboard.AlwaysOnTop = true
    Billboard.Parent = game.CoreGui
    Billboard.Enabled = RoleViewerToggle.Value

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Font = Enum.Font.GothamBold
    Text.TextStrokeTransparency = 0.25
    Text.Text = ""
    Text.TextColor3 = Color3.fromRGB(255,255,255)

    ROLE_TAGS[player] = {Billboard = Billboard, Text = Text}

    local function UpdateRole()
        local ps = player:FindFirstChild("PublicStates")
        if ps then
            local roleVal = ps:FindFirstChild("Role")
            if roleVal then
                Text.Text = roleVal.Value
                Text.TextColor3 = ROLE_COLORS[roleVal.Value] or Color3.new(1,1,1)
            end
        end
    end

    if player:FindFirstChild("PublicStates") then
        for _, v in pairs(player.PublicStates:GetChildren()) do
            if v:IsA("StringValue") then
                v.Changed:Connect(UpdateRole)
            end
        end
    end
    UpdateRole()
end

local function CreateDeadBodyTag(part)
    if DEAD_BODIES[part] then return end
    local Billboard = Instance.new("BillboardGui")
    Billboard.Name = "DeadBodyTag"
    Billboard.Adornee = part
    Billboard.Size = UDim2.new(0,200,0,40)
    Billboard.AlwaysOnTop = true
    Billboard.Parent = game.CoreGui
    Billboard.Enabled = DeadBodyToggle.Value

    local Text = Instance.new("TextLabel")
    Text.Parent = Billboard
    Text.Size = UDim2.new(1,0,1,0)
    Text.BackgroundTransparency = 1
    Text.TextScaled = true
    Text.Text = "DEAD BODY!"

    DEAD_BODIES[part] = {Billboard = Billboard, TextLabel = Text}

    spawn(function()
        while Text.Parent do
            for i=0,1,0.01 do
                Text.TextColor3 = Color3.fromHSV(i,1,1)
                wait(0.05)
            end
        end
    end)
end

-- Detect dead bodies
RunService.Heartbeat:Connect(function()
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj.Name == "DeadBody" then
            local hrp = obj:FindFirstChild("HumanoidRootPart")
            if hrp then CreateDeadBodyTag(hrp) end
        end
    end
end)

-- Hooks
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        AttachRoleTag(player)
        AttachESP(player)
    end)
end)

for _, p in pairs(Players:GetPlayers()) do
    if p ~= LocalPlayer then
        AttachRoleTag(p)
        AttachESP(p)
    end
end
