--[[ 
    Lley And Aris Chat Gpt Hub
    All-in-one Luau Script
]]--

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local camera = workspace.CurrentCamera
local player = Players.LocalPlayer

-- Load WindUI
local WindUI
do
    local ok, result = pcall(function()
        return require("./src/Init")
    end)
    if ok then WindUI = result
    else WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))() end
end

-- States
local state = {
    noclip = false,
    maxZoom = false,
    fullVision = false,
    roleView = false,
    esp = false,
    deadBodyESP = false,
}
local oldCameraMaxZoom = player.CameraMaxZoomDistance
local oldLighting = {FogStart=Lighting.FogStart,FogEnd=Lighting.FogEnd,Ambient=Lighting.Ambient}

-- Role Colors
local ROLE_COLORS = {Crewmate=Color3.fromRGB(0,255,0), Imposter=Color3.fromRGB(255,0,0), Neutral=Color3.fromRGB(255,165,0)}

-- Create Window
local Window = WindUI:CreateWindow({
    Title = "Lley And Aris Chat Gpt Hub",
    Folder = "ChatGPTArisHub",
    OpenButton = {
        Title = "Lley And Aris Chat Gpt Hub",
        Enabled = true,
        Draggable = true,
        Color = ColorSequence.new(Color3.fromRGB(128,0,128), Color3.fromRGB(200,100,255)),
    },
})

WindUI:AddTheme({
    Name="PurpleTheme",
    Accent=Color3.fromRGB(128,0,128), Dialog=Color3.fromRGB(30,0,60),
    Outline=Color3.fromRGB(128,0,128), Text=Color3.fromRGB(255,255,255),
    Button=Color3.fromRGB(80,0,120), WindowBackground=Color3.fromRGB(20,0,40),
})
WindUI:SetTheme("PurpleTheme")

-- Main Tab
local MainTab = Window:Tab({Title="Main", Icon="solar:check-square-bold"})

-- Noclip Section
local NoclipSection = MainTab:Section({Title="Noclip"})
NoclipSection:Toggle({Title="Enable Noclip", Default=false, Callback=function(v) state.noclip=v end})

-- ESP Section
local ESPSection = MainTab:Section({Title="ESP"})
ESPSection:Toggle({Title="Role View", Default=false, Callback=function(v)
    state.roleView=v
    if v then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/mehCake/Roblox-Imposters-and-roles-script/refs/heads/main/Script.txt"))()
    else
        for _,plr in ipairs(Players:GetPlayers()) do
            if plr.Character then
                for _,c in ipairs(plr.Character:GetDescendants()) do
                    if c.Name=="RoleTag" then c:Destroy() end
                end
            end
        end
    end
end})
ESPSection:Toggle({Title="ESP Humanoids Only", Default=false, Callback=function(v) state.esp=v end})

-- Game Enhancer Section
local GameEnhancerSection = MainTab:Section({Title="Game Enhancer"})
GameEnhancerSection:Toggle({Title="Full Vision", Default=false, Callback=function(v)
    state.fullVision=v
    if v then Lighting.FogStart=0; Lighting.FogEnd=100000; Lighting.Ambient=Color3.new(1,1,1)
    else Lighting.FogStart=oldLighting.FogStart; Lighting.FogEnd=oldLighting.FogEnd; Lighting.Ambient=oldLighting.Ambient end
end})
GameEnhancerSection:Toggle({Title="Max Zoom", Default=false, Callback=function(v)
    state.maxZoom=v
    player.CameraMaxZoomDistance = v and 1000 or oldCameraMaxZoom
end})
GameEnhancerSection:Toggle({Title="Dead Body ESP", Default=false, Callback=function(v) state.deadBodyESP=v end})

-- Noclip logic
RunService.Stepped:Connect(function()
    if state.noclip and player.Character then
        for _,p in ipairs(player.Character:GetDescendants()) do
            if p:IsA("BasePart") then p.CanCollide=false end
        end
    end
end)

-- ESP Drawing
local ESPBoxes, DeadBodyBoxes, DeadBodyTexts, notifiedBodies = {}, {}, {}, {}
local hue=0
local function getRainbowColor() hue=(hue+1)%360; return Color3.fromHSV(hue/360,1,1) end

local function createESPBox() local box=Drawing.new("Square"); box.Thickness=2; box.Filled=false; box.Size=Vector2.new(20,20); return box end
local function createDeadBodyESP(body)
    local box=Drawing.new("Square"); box.Color=Color3.fromRGB(255,0,0); box.Thickness=2; box.Filled=false; box.Size=Vector2.new(30,30)
    local text=Drawing.new("Text"); text.Text="DEAD BODY"; text.Center=true; text.Outline=true; text.Size=18
    return box,text
end

-- DeadBody child added
workspace.ChildAdded:Connect(function(c)
    if c.Name=="DeadBody" then
        if state.deadBodyESP then DeadBodyBoxes[c],DeadBodyTexts[c]=createDeadBodyESP(c) end
        if not notifiedBodies[c] then
            WindUI:Notify({Title="DEAD BODY!", Content="A dead body has been found!"})
            notifiedBodies[c]=true
        end
    end
end)

-- ESP render
RunService.RenderStepped:Connect(function()
    -- Humanoid ESP
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr~=player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if state.esp then
                if not ESPBoxes[plr] then ESPBoxes[plr]=createESPBox() end
                local box=ESPBoxes[plr]
                local pos,onScreen=camera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
                if onScreen then
                    box.Position=Vector2.new(pos.X-10,pos.Y-10)
                    local role="Neutral"
                    local ps=plr:FindFirstChild("PublicStates")
                    if ps and ps:FindFirstChild("Role") then role=ps.Role.Value end
                    box.Color=ROLE_COLORS[role] or Color3.new(1,1,1)
                    box.Visible=true
                else box.Visible=false end
            elseif ESPBoxes[plr] then ESPBoxes[plr]:Remove(); ESPBoxes[plr]=nil end
        end
    end

    -- DeadBody ESP + Rainbow Text
    for body,box in pairs(DeadBodyBoxes) do
        if body and body.Parent then
            local pos,onScreen=camera:WorldToViewportPoint(body.Position+Vector3.new(0,3,0))
            local text=DeadBodyTexts[body]
            if onScreen then
                box.Position=Vector2.new(pos.X-15,pos.Y-15); box.Visible=true
                text.Position=Vector2.new(pos.X,pos.Y-20); text.Visible=true; text.Color=getRainbowColor()
            else box.Visible=false; text.Visible=false end
        end
    end
end)
